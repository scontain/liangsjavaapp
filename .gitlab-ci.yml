stages:
  - build
  - package
  - test
  - deploy

include:
  - project: 'feature-team/gitlab-pipeline-templates'
    ref: master
    file: '/templates/common-build.yml'
  - project: 'feature-team/gitlab-pipeline-templates'
    ref: master
    file: '/templates/common-docker.yml'
  - project: 'feature-team/gitlab-pipeline-templates'
    ref: master
    file: '/templates/common-container-scanning.yml'
  - project: 'feature-team/gitlab-pipeline-templates'
    ref: master
    file: '/templates/common-sast.yml'
  - project: 'feature-team/gitlab-pipeline-templates'
    ref: master
    file: '/templates/common-helm-deploy.yml'

build:
  extends: .common-build:build
  stage: build
  tags:
    - development

docker_build:
  extends: .common-docker:image-build
  stage: package
  tags:
    - development

container_scanning:
  extends: .common-container-scanning:container-scanning
  stage: test
  tags:
    - development

sast:
  extends: .common-sast:sast
  image: docker:stable
  tags:
    - development
  stage: test

deploy-dev:
  extends: .common-helm-deploy:deploy
  tags:
    - development
  stage: deploy
  only:
    - master
